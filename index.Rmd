---
title: "COMPUTATIONAL MUSICOLOGY"
author: "Pierre Mugisha"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 3
      bg: "#3000a1"
      fg: "#0058a1" 
      primary: "#ED79F9"
      navbar-bg: "#3000a1"
      base_font: 
        google: Prompt
      heading_font:
        google: Sen
      code_font:
        google: 
          # arguments to sass::font_google() 
          family: JetBrains Mono
          local: false
    storyboard: true
    
---


  
### Introduction
  
```{r picture, echo = F, fig.cap = "newsroom.spotify.com", out.width = '100%'}
knitr::include_graphics("WHATS_NEW-HEADER-1440X733.png")

```


***
  
This storyboard is about my spotify wrapped playlist for 2021. For some features it is going to get compared to my spotify wrapped playlist of 2022.

<iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/37i9dQZF1EMfweBkW6hPXV?utm_source=generator" width="100%" height="380" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

***
As said above, the corpora used in this storyboard are my spotify wrapped playlist for 2020 and 2021. I've chosen these corpora,  because I listen to multiple different genres each year, and these playlists are a summarization of the year. The interesting part of these playlists is that it can show me my music listening behaviour during the pandemic/lockdown(from the start in 2020 up untill close to the end of it 2021). 

One of the natural "groups" in my corpus are the genres, I listen predominantly to the following genres: Hip Hop/Rap, House/Dance, Piano/Orchestra and sometimes Pop. I except some differences among these genres(e.g. tempo, speechiness, instrumentalness). Altough there is probably some overlap between the 2020 and the 2021 playlist, I also expect some differences between the playlist.

Some atypical tracks in my 2021 playlist are: "Un diavolo scaccia l'altro" of Lee Nyeom and "Retributor" of Lee Nyeom and Park Sejun. These tracks belong to the Original Television Soundtrack of VINCENZO -an K-action/drama show.

<iframe src="https://open.spotify.com/embed/playlist/4xnBi0S21rFHhhK0iGHpiS?utm_source=generator" width="100%" height="380" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

### Preliminary Visualisations
  
```{r}
library(tidyverse)
library(spotifyr)
library(dplyr)
library(compmus)
library(plotly)


spot2020 <- get_playlist_audio_features("", "37i9dQZF1EMfweBkW6hPXV?si=540832d31503420a")
spot <- get_playlist_audio_features("", "6BKuhkNHlpwnhcRBR5GMlz?si=128d70c3b2624650")

spot2021 <- spot %>%
  select(danceability, energy, key, loudness, mode, speechiness,
         acousticness, instrumentalness, liveness, valence, tempo,
         track.duration_ms, track.explicit, track.name, track.popularity,
         track.album.release_date, track.album.artists) #%>%
  #mutate(track.album.artists = str_c(track.album.artists, sep = " "))


spot2020_1 <- spot2020 %>%
  select(danceability, energy, key, loudness, mode, speechiness,
         acousticness, instrumentalness, liveness, valence, tempo,
         track.duration_ms, track.explicit, track.name, track.popularity,
         track.album.release_date, track.album.artists)

spot2021$newdate <- strptime(as.character(spot2021$track.album.release_date), "%Y-%m-%d")
spot2021$year <- format(spot2021$newdate, "%Y")

spot2021$newdate <- strptime(as.character(spot2021$track.album.release_date), "%Y")
spot2021$year <- format(spot2021$newdate, "%Y")

spot2020_1$newdate <- strptime(as.character(spot2020_1$track.album.release_date), "%Y-%m-%d")
spot2020_1$year <- format(spot2020_1$newdate, "%Y")

spot2020_1$newdate <- strptime(as.character(spot2020_1$track.album.release_date), "%Y")
spot2020_1$year <- format(spot2020_1$newdate, "%Y")

topnummers <-
  bind_rows(
    spot2020_1 %>% mutate(category = "2020"),
    spot2021 %>% mutate(category = "2021")
    
  )

topnummers_gg <- topnummers%>%                    # Start with awards.
  mutate(
    mode = ifelse(mode == 0, "Minor", "Major")
  ) %>%
  ggplot(                     # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = loudness,
      colour = mode,
      label = track.name
    )
  ) +
  geom_point() +              # Scatter plot.
  geom_rug(size = 0.1) +      # Add 'fringes' to show data distribution.
  geom_text(                  # Add text labels from above.
    aes(
      x = valence,
      y = energy,
      label = label
    ),
    data = 
      tibble(
        label = c("", ""),
        category = c("2020", "2021"),
        valence = c(0.090, 0.123),
        energy = c(0.101, 0.967)
      ),
    colour = "black",         # Override colour (not mode here).
    size = 3,                 # Override size (not loudness here).
    hjust = "left",           # Align left side of label with the point.
    vjust = "bottom",         # Align bottom of label with the point.
    nudge_x = -0.05,          # Nudge the label slightly left.
    nudge_y = 0.02            # Nudge the label slightly up.
  ) +
  facet_wrap(~category) +     # Separate charts per playlist.
  scale_x_continuous(         # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),   # Use grid-lines for quadrants only.
    minor_breaks = NULL       # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(         # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(        # Use the Color Brewer to choose a palette.
    type = "qual",            # Qualitative set.
    palette = "Paired"        # Name of the palette is 'Paired'.
  ) +
  scale_size_continuous(      # Fine-tune the sizes of each point.
    trans = "exp",            # Use an exp transformation to emphasise loud.
    guide = "none"            # Remove the legend for size.
  ) +
  theme_light() +             # Use a simpler theme.
  labs(                       # Make the titles nice.
    x = "Valence",
    y = "Energy",
    colour = "Mode"
  )

ggplotly(topnummers_gg)



```


***
  
descr

### Energy vs Valence

```{r}

ggplot(spot, aes(valence, energy, color=mode)) +
  geom_point(alpha=0.6) +
  theme_classic()
```
***


### Chromagrams

```{r}
vinch1 <-
  get_tidy_audio_analysis("7AnHS1o08tFXLmnOedcucv?si=2bba8cb44ac6432f") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

vinch2 <-
  get_tidy_audio_analysis("1M4nbJUGkuBhI7Tx9lmeXp?si=e602daaa62524623") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

vinchenzo <-
  bind_rows(
    vinch1 %>% mutate(category = "Un diavolo scaccia l'altro"),
    vinch2 %>% mutate(category = "Retributor")
    
  )

vinchenzo %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  facet_wrap(~category) +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

***
Chromagram using euclidean

###  Chroma -and Timbre Self-Similarity Matrices "Dark Horse" -Katy Perry, Juicy J
  
```{r}
vinchen1 <-
  get_tidy_audio_analysis("5jrdCoLpJSvHHorevXBATy?si=3bab498e69004e5a") %>%
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )
bind_rows(
  vinchen1 %>% 
    compmus_self_similarity(pitches, "aitchison") %>% 
    mutate(d = d / max(d), type = "Chroma"),
  vinchen1 %>% 
    compmus_self_similarity(timbre, "euclidean") %>% 
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C") +
  theme_classic() + 
  labs(x = "", y = "")
```

***
  
One song I liked to listen to in the gym in 2021 was 'Dark Horse'(2013) by Katy Perry and Juicy J, due to the "Trap"-type beat and the verse of Juicy J. The chroma-based matrix of the song, picks up mostly the chorus of the song. In the timbre matrix, one can see the beginning of every verse and the end of the chorus(tiny square that gets faintly darker) clearly.

###  Chroma -and Timbre Self-Similarity Matrices "Power" -Kanye West
  
```{r}
difference <-
  get_tidy_audio_analysis("2gZUPNdnz5Y45eiGxpHGSc?si=4ad3b79c4ada47da") %>%
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )
bind_rows(
  difference %>% 
    compmus_self_similarity(pitches, "aitchison") %>% 
    mutate(d = d / max(d), type = "Chroma"),
  difference %>% 
    compmus_self_similarity(timbre, "euclidean") %>% 
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C") +
  theme_classic() + 
  labs(x = "", y = "")
```

***

Another song I like to listen to in the gym is 'POWER' by Kanye West, this masterpiece, contains a lot of hidden messages in the lyrics and it contains vocals in the background almost throughout the whole song, this can be seen by the big square in the chroma matrix. 
Another part of the song that is picked up by the chroma matrix, is the part after the bridge. Here, right around 3:20 the track seems to slow down for a moment, and then it continues with the normal speed.
In the timbre matrix one can see the beginning and end of each verse.


### Conclusion
```{r}

```

<iframe src="https://open.spotify.com/embed/track/3n2NAmdRX21gSgKvVx4wMf" width="300" height="380" frameborder="0" allowtransparency="true"></iframe>



***
  
descr

  




